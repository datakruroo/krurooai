#!/bin/bash

# KruRooAI - Educational AI Assistant CLI
# Main executable script

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_DIR="$(dirname "$SCRIPT_DIR")"

# If script is symlinked, resolve to actual location
if [[ -L "${BASH_SOURCE[0]}" ]]; then
    REAL_SCRIPT="$(readlink "${BASH_SOURCE[0]}")"
    SCRIPT_DIR="$(cd "$(dirname "$REAL_SCRIPT")" && pwd)"
    PROJECT_DIR="$(dirname "$SCRIPT_DIR")"
fi

# Check if R is installed
if ! command -v Rscript &> /dev/null; then
    echo "Error: R is not installed or not in PATH"
    echo "Please install R from https://www.r-project.org/"
    exit 1
fi

# Check if Python is installed
if ! command -v python3 &> /dev/null; then
    echo "Error: Python 3 is not installed or not in PATH"
    echo "Please install Python 3"
    exit 1
fi

# Store original working directory
ORIGINAL_DIR="$(pwd)"

# Set working directory to project root
cd "$PROJECT_DIR"

# Add Python directory to PYTHONPATH
export PYTHONPATH="$PROJECT_DIR/python:$PYTHONPATH"

# Set environment variable for original directory
export KRUROOAI_ORIGINAL_DIR="$ORIGINAL_DIR"

# Run the R main script with all arguments
# Pass arguments and original directory via environment and command line
Rscript "$PROJECT_DIR/R/main.R" "$@"